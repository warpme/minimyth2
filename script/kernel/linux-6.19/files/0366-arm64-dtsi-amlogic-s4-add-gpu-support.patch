Patch from MiniMyth2 project

Developed-by: Piotr Oniszczuk <piotr.oniszczuk@gmail.com>
Signed-off-by: Piotr Oniszczuk <piotr.oniszczuk@gmail.com>



diff --speed-large-files --no-dereference --minimal -Naur linux-6.18.3/arch/arm64/boot/dts/amlogic/meson-s4.dtsi linux-6.18.3/arch/arm64/boot/dts/amlogic/meson-s4.dtsi
--- linux-6.18.3/arch/arm64/boot/dts/amlogic/meson-s4.dtsi	2026-01-09 13:39:31.113716624 +0100
+++ linux-6.18.3/arch/arm64/boot/dts/amlogic/meson-s4.dtsi	2026-01-09 13:37:52.737047314 +0100
@@ -118,6 +120,39 @@
 		};
 	};
 
+	gpu_opp_table: opp-table-gpu {
+		compatible = "operating-points-v2";
+
+		opp-124999998 {
+			opp-hz = /bits/ 64 <124999998>;
+			opp-microvolt = <800000>;
+		};
+		opp-249999996 {
+			opp-hz = /bits/ 64 <249999996>;
+			opp-microvolt = <800000>;
+		};
+		opp-285714281 {
+			opp-hz = /bits/ 64 <285714281>;
+			opp-microvolt = <800000>;
+		};
+		opp-399999994 {
+			opp-hz = /bits/ 64 <399999994>;
+			opp-microvolt = <800000>;
+		};
+		opp-499999992 {
+			opp-hz = /bits/ 64 <499999992>;
+			opp-microvolt = <800000>;
+		};
+		opp-666666656 {
+			opp-hz = /bits/ 64 <666666656>;
+			opp-microvolt = <800000>;
+		};
+		opp-799999987 {
+			opp-hz = /bits/ 64 <799999987>;
+			opp-microvolt = <800000>;
+		};
+	};
+
 	soc {
 		compatible = "simple-bus";
 		#address-cells = <2>;
@@ -1060,6 +1088,27 @@
 				};
 			};
 		};
+
+		gpu: gpu@fe400000 {
+			compatible = "amlogic,meson-s4-mali";
+			reg = <0x00 0xfe400000 0x00 0x40000>;
+
+			interrupt-parent = <&gic>;
+			interrupts = <GIC_SPI 146 IRQ_TYPE_LEVEL_HIGH>,
+				     <GIC_SPI 145 IRQ_TYPE_LEVEL_HIGH>,
+				     <GIC_SPI 144 IRQ_TYPE_LEVEL_HIGH>;
+			interrupt-names = "job", "mmu", "gpu";
+
+			clocks = <&clkc_periphs CLKID_MALI_SEL>,
+					  <&clkc_periphs CLKID_MALI>;
+			clock-names = "core", "bus";
+
+			resets = <&reset RESET_MALI>,
+				 <&reset RESET_MALI_APB>;
+
+			operating-points-v2 = <&gpu_opp_table>;
+			#cooling-cells = <2>;
+		};
 	};
 };
 
--

MiniMyth2

