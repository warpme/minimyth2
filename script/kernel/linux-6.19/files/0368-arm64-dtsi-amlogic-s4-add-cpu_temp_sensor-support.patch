Patch from MiniMyth2 project

Developed-by: Piotr Oniszczuk <piotr.oniszczuk@gmail.com>
Signed-off-by: Piotr Oniszczuk <piotr.oniszczuk@gmail.com>




diff --speed-large-files --no-dereference --minimal -Naur linux-6.18.7/arch/arm64/boot/dts/amlogic/meson-s4.dtsi linux-6.18.7/arch/arm64/boot/dts/amlogic/meson-s4.dtsi
--- linux-6.18.7/arch/arm64/boot/dts/amlogic/meson-s4.dtsi	2026-01-26 17:54:36.863930921 +0100
+++ linux-6.18.7/arch/arm64/boot/dts/amlogic/meson-s4.dtsi	2026-01-26 17:22:52.792181725 +0100
@@ -28,6 +28,7 @@
 			compatible = "arm,cortex-a35";
 			reg = <0x0 0x0>;
 			enable-method = "psci";
+			#cooling-cells = <2>;
 		};
 
 		cpu1: cpu@1 {
@@ -35,6 +36,7 @@
 			compatible = "arm,cortex-a35";
 			reg = <0x0 0x1>;
 			enable-method = "psci";
+			#cooling-cells = <2>;
 		};
 
 		cpu2: cpu@2 {
@@ -42,6 +44,7 @@
 			compatible = "arm,cortex-a35";
 			reg = <0x0 0x2>;
 			enable-method = "psci";
+			#cooling-cells = <2>;
 		};
 
 		cpu3: cpu@3 {
@@ -49,6 +52,7 @@
 			compatible = "arm,cortex-a35";
 			reg = <0x0 0x3>;
 			enable-method = "psci";
+			#cooling-cells = <2>;
 		};
 	};
 
@@ -885,6 +889,16 @@
 				status = "disabled";
 			};
 
+			cpu_temp: temperature-sensor@20000 {
+				compatible = "amlogic,s4-cpu-thermal",
+					     "amlogic,g12a-thermal";
+				reg = <0x0 0x20000 0x0 0x50>;
+				interrupts = <GIC_SPI 30 IRQ_TYPE_LEVEL_HIGH>;
+				clocks = <&clkc_periphs CLKID_TS>;
+				#thermal-sensor-cells = <0>;
+				amlogic,ao-secure = <&sec_ao>;
+			};
+
 			reset: reset-controller@2000 {
 				compatible = "amlogic,meson-s4-reset";
 				reg = <0x0 0x2000 0x0 0x98>;
@@ -1437,4 +1451,32 @@
 		clock-names = "pclk", "dclk", "sysclk";
 		resets = <&clkc_audio AUD_RESET_PDM>;
 	};
+
+	thermal-zones {
+		cpu_thermal: cpu-thermal {
+			polling-delay = <1000>;
+			polling-delay-passive = <100>;
+			thermal-sensors = <&cpu_temp>;
+
+			trips {
+				cpu_passive: cpu-passive {
+					temperature = <85000>; /* millicelsius */
+					hysteresis = <2000>; /* millicelsius */
+					type = "passive";
+				};
+
+				cpu_hot: cpu-hot {
+					temperature = <95000>; /* millicelsius */
+					hysteresis = <2000>; /* millicelsius */
+					type = "hot";
+				};
+
+				cpu_critical: cpu-critical {
+					temperature = <110000>; /* millicelsius */
+					hysteresis = <2000>; /* millicelsius */
+				    type = "critical";
+				};
+			};
+		};
+	};
 };
--

MiniMyth2

