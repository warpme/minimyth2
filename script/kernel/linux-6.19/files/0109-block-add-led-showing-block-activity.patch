Patch from MiniMyth2 project

Developed-by: Piotr Oniszczuk <piotr.oniszczuk@gmail.com>
Signed-off-by: Piotr Oniszczuk <piotr.oniszczuk@gmail.com>



diff --speed-large-files --no-dereference --minimal -Naur linux-6.19.1/block/blk-mq.c linux-6.19.1/block/blk-mq.c
--- linux-6.19.1/block/blk-mq.c	2026-02-16 10:13:34.000000000 +0100
+++ linux-6.19.1/block/blk-mq.c	2026-02-19 11:54:30.892006896 +0100
@@ -30,6 +30,7 @@
 #include <linux/blk-crypto.h>
 #include <linux/part_stat.h>
 #include <linux/sched/isolation.h>
+#include <linux/leds.h>
 
 #include <trace/events/block.h>
 
@@ -1077,6 +1078,8 @@
 				    in_flight[op_is_write(req_op(req))]);
 		part_stat_unlock();
 	}
+
+	ledtrig_disk_activity(true);
 }
 
 static inline bool blk_rq_passthrough_stats(struct request *req)
diff --speed-large-files --no-dereference --minimal -Naur linux-6.19.1/drivers/leds/trigger/ledtrig-disk.c linux-6.19.1/drivers/leds/trigger/ledtrig-disk.c
--- linux-6.19.1/drivers/leds/trigger/ledtrig-disk.c	2026-02-16 10:13:34.000000000 +0100
+++ linux-6.19.1/drivers/leds/trigger/ledtrig-disk.c	2026-02-19 12:03:10.138786741 +0100
@@ -11,7 +11,7 @@
 #include <linux/init.h>
 #include <linux/leds.h>
 
-#define BLINK_DELAY 30
+#define BLINK_DELAY 1
 
 DEFINE_LED_TRIGGER(ledtrig_disk);
 DEFINE_LED_TRIGGER(ledtrig_disk_read);
@@ -22,10 +22,10 @@
 	led_trigger_blink_oneshot(ledtrig_disk, BLINK_DELAY, BLINK_DELAY, 0);
 	if (write)
 		led_trigger_blink_oneshot(ledtrig_disk_write,
-					  BLINK_DELAY, BLINK_DELAY, 0);
+					  BLINK_DELAY, 0, 0);
 	else
 		led_trigger_blink_oneshot(ledtrig_disk_read,
-					  BLINK_DELAY, BLINK_DELAY, 0);
+					  BLINK_DELAY, 0, 0);
 }
 EXPORT_SYMBOL(ledtrig_disk_activity);
 
--

MiniMyth2

