Patch from MiniMyth2 project

Developed-by: Piotr Oniszczuk <piotr.oniszczuk@gmail.com>
Signed-off-by: Piotr Oniszczuk <piotr.oniszczuk@gmail.com>



diff --speed-large-files --no-dereference --minimal -Naur linux-6.18-rc4/arch/arm64/boot/dts/broadcom/bcm2712.dtsi linux-6.18-rc4/arch/arm64/boot/dts/broadcom/bcm2712.dtsi
--- linux-6.18-rc4/arch/arm64/boot/dts/broadcom/bcm2712.dtsi	2025-11-04 14:31:00.608833191 +0100
+++ linux-6.18-rc4/arch/arm64/boot/dts/broadcom/bcm2712.dtsi	2025-11-04 14:30:00.205499643 +0100
@@ -262,23 +262,54 @@
 			#mbox-cells = <0>;
 		};
 
-		uart10: serial@7d001000 {
-			compatible = "arm,pl011", "arm,primecell";
-			reg = <0x7d001000 0x200>;
-			interrupts = <GIC_SPI 121 IRQ_TYPE_LEVEL_HIGH>;
-			clocks = <&clk_uart>, <&clk_vpu>;
-			clock-names = "uartclk", "apb_pclk";
-			arm,primecell-periphid = <0x00341011>;
-			status = "disabled";
-		};
-
 		pinctrl: pinctrl@7d504100 {
-			compatible = "brcm,bcm2712c0-pinctrl";
+			compatible = "brcm,bcm2712-pinctrl";
 			reg = <0x7d504100 0x30>;
+
+			uarta_24_pins: uarta_24_pins {
+				pin_rts {
+					function = "uart0";
+					pins = "gpio24";
+					bias-disable;
+				};
+				pin_cts {
+					function = "uart0";
+					pins = "gpio25";
+					bias-pull-up;
+				};
+				pin_txd {
+					function = "uart0";
+					pins = "gpio26";
+					bias-disable;
+				};
+				pin_rxd {
+					function = "uart0";
+					pins = "gpio27";
+					bias-pull-up;
+				};
+			};
+
+			sdio2_30_pins: sdio2_30_pins {
+				pin_clk {
+					function = "sd2";
+					pins = "gpio30";
+					bias-disable;
+				};
+				pin_cmd {
+					function = "sd2";
+					pins = "gpio31";
+					bias-pull-up;
+				};
+				pins_dat {
+					function = "sd2";
+					pins = "gpio32", "gpio33", "gpio34", "gpio35";
+					bias-pull-up;
+				};
+			};
 		};
 
 		gio: gpio@7d508500 {
-			compatible = "brcm,bcm7445-gpio", "brcm,brcmstb-gpio";
+			compatible = "brcm,brcmstb-gpio";
 			reg = <0x7d508500 0x40>;
 			interrupt-parent = <&main_irq>;
 			interrupts = <0>;
@@ -287,6 +318,17 @@
 			interrupt-controller;
 			#interrupt-cells = <2>;
 			brcm,gpio-bank-widths = <32 22>;
+			brcm,gpio-direct;
+		};
+
+		uart10: serial@7d001000 {
+			compatible = "arm,pl011", "arm,primecell";
+			reg = <0x7d001000 0x200>;
+			interrupts = <GIC_SPI 121 IRQ_TYPE_LEVEL_HIGH>;
+			clocks = <&clk_uart>, <&clk_vpu>;
+			clock-names = "uartclk", "apb_pclk";
+			arm,primecell-periphid = <0x00341011>;
+			status = "disabled";
 		};
 
 		uarta: serial@7d50c000 {
@@ -325,21 +367,6 @@
 			 */
 		};
 
-		sdio2: mmc@1100000 {
-			compatible = "brcm,bcm2712-sdhci",
-				     "brcm,sdhci-brcmstb";
-			reg = <0x01100000  0x260>,
-			      <0x01100400  0x200>;
-			reg-names = "host", "cfg";
-			interrupts = <GIC_SPI 274 IRQ_TYPE_LEVEL_HIGH>;
-			clocks = <&clk_emmc2>;
-			clock-names = "sw_sdio";
-			sdhci-caps-mask = <0x0000C000 0x0>;
-			sdhci-caps = <0x0 0x0>;
-			mmc-ddr-3_3v;
-			status = "disabled";
-		};
-
 		gicv2: interrupt-controller@7fff9000 {
 			compatible = "arm,gic-400";
 			reg = <0x7fff9000 0x1000>,
@@ -755,6 +782,20 @@
 			//iommus = <&iommu2>;
 			status = "okay";
 		};
+
+		sdio2: mmc@1100000 {
+			compatible = "brcm,bcm2712-sdhci";
+			reg = <0x10 0x01100000  0x0 0x260>,
+			      <0x10 0x01100400  0x0 0x200>;
+			reg-names = "host", "cfg";
+			interrupts = <GIC_SPI 274 IRQ_TYPE_LEVEL_HIGH>;
+			clocks = <&clk_emmc2>;
+			sdhci-caps-mask = <0x0000C000 0x0>;
+			sdhci-caps = <0x0 0x0>;
+			supports-cqe;
+			mmc-ddr-3_3v;
+			status = "disabled";
+		};
 	};
 
 	timer {
--

MiniMyth2

