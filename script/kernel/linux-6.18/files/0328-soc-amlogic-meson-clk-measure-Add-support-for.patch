
From: devmfc <devmfc@mvand.net>
Subject: [PATCH 28/32] [DEVMFC] soc: amlogic: meson-clk-measure: Add support
 for SC2 SoC

diff --speed-large-files --no-dereference --minimal -Naur linux-6.18-rc5/drivers/soc/amlogic/meson-clk-measure.c linux-6.18-rc5/drivers/soc/amlogic/meson-clk-measure.c
--- linux-6.18-rc5/drivers/soc/amlogic/meson-clk-measure.c	2025-11-10 00:10:19.000000000 +0100
+++ linux-6.18-rc5/drivers/soc/amlogic/meson-clk-measure.c	2025-11-15 09:17:21.276072376 +0100
@@ -28,6 +28,8 @@
 #define DIV_STEP		32
 #define DIV_MAX			640
 
+#define CLK_MSR_MAX		200
+
 struct meson_msr_id {
 	struct meson_msr *priv;
 	unsigned int id;
@@ -787,6 +789,136 @@
 
 };
 
+static struct meson_msr_id clk_msr_sc2[CLK_MSR_MAX] = {
+	CLK_MSR_ID(0, "cts_sys_clk"),
+	CLK_MSR_ID(1, "cts_axi_clk "),
+	CLK_MSR_ID(2, "cts_rtc_clk"),
+	CLK_MSR_ID(3, "cts_dspa_clk"),
+	CLK_MSR_ID(5, "cts_mali_clk"),
+	CLK_MSR_ID(6, "sys_cpu_clk_div16"),
+	CLK_MSR_ID(7, "cts_ceca_clk"),
+	CLK_MSR_ID(8, "cts_cecb_clk"),
+	CLK_MSR_ID(10, "fclk_div5"),
+	CLK_MSR_ID(11, "mp0_clk_out"),
+	CLK_MSR_ID(12, "mp1_clk_out"),
+	CLK_MSR_ID(13, "mp2_clk_out"),
+	CLK_MSR_ID(14, "mp3_clk_out"),
+	CLK_MSR_ID(15, "mpll_clk_50m"),
+	CLK_MSR_ID(16, "pcie_clk_inp"),
+	CLK_MSR_ID(17, "pcie_clk_inn"),
+	CLK_MSR_ID(18, "mpll_clk_test_out"),
+	CLK_MSR_ID(19, "hifi_pll_clk"),
+	CLK_MSR_ID(20, "gp0_pll_clk"),
+	CLK_MSR_ID(21, "gp1_pll_clk"),
+	CLK_MSR_ID(22, "eth_mppll_50m_ckout"),
+	CLK_MSR_ID(23, "sys_pll_div16"),
+	CLK_MSR_ID(24, "ddr_dpll_pt_clk"),
+	CLK_MSR_ID(25, "earcrx_pll_ckout"),
+	CLK_MSR_ID(30, "mod_eth_phy_ref_clk"),
+	CLK_MSR_ID(31, "mod_eth_tx_clk"),
+	CLK_MSR_ID(32, "cts_eth_clk125Mhz"),
+	CLK_MSR_ID(33, "cts_eth_clk_rmii"),
+	CLK_MSR_ID(34, "co_clkin_to_mac"),
+	CLK_MSR_ID(35, "mod_eth_rx_clk_rmii"),
+	CLK_MSR_ID(36, "co_rx_clk "),
+	CLK_MSR_ID(37, "co_tx_clk"),
+	CLK_MSR_ID(38, "eth_phy_rxclk"),
+	CLK_MSR_ID(39, "eth_phy_plltxclk"),
+	CLK_MSR_ID(40, "ephy_test_clk"),
+	CLK_MSR_ID(50, "vid_pll_div_clk_out"),
+	CLK_MSR_ID(51, "cts_enci_clk"),
+	CLK_MSR_ID(52, "cts_encp_clk"),
+	CLK_MSR_ID(53, "cts_encl_clk"),
+	CLK_MSR_ID(54, "cts_vdac_clk"),
+	CLK_MSR_ID(55, "cts_cdac_clk_c"),
+	CLK_MSR_ID(56, "mod_tcon_clko"),
+	CLK_MSR_ID(57, "lcd_an_clk_ph2"),
+	CLK_MSR_ID(58, "lcd_an_clk_ph3"),
+	CLK_MSR_ID(59, "cts_hdmi_tx_pixel_clk"),
+	CLK_MSR_ID(60, "cts_vdin_meas_clk"),
+	CLK_MSR_ID(61, "cts_vpu_clk"),
+	CLK_MSR_ID(62, "cts_vpu_clkb"),
+	CLK_MSR_ID(63, "cts_vpu_clkb_tmp"),
+	CLK_MSR_ID(64, "cts_vpu_clkc"),
+	CLK_MSR_ID(65, "cts_vid_lock_clk"),
+	CLK_MSR_ID(66, "cts_vapbclk"),
+	CLK_MSR_ID(67, "cts_ge2d_clk"),
+	CLK_MSR_ID(68, "cts_hdcp22_esmclk"),
+	CLK_MSR_ID(69, "cts_hdcp22_skpclk"),
+	CLK_MSR_ID(76, "hdmitx_tmds_clk"),
+	CLK_MSR_ID(77, "cts_hdmitx_sys_clk"),
+	CLK_MSR_ID(78, "cts_hdmitx_fe_clk"),
+	CLK_MSR_ID(79, "cts_rama_clk"),
+	CLK_MSR_ID(93, "cts_vdec_clk"),
+	CLK_MSR_ID(94, "cts_wave420_aclk"),
+	CLK_MSR_ID(95, "cts_wave420_cclk"),
+	CLK_MSR_ID(96, "cts_wave420_bclk"),
+	CLK_MSR_ID(97, "cts_hcodec_clk"),
+	CLK_MSR_ID(98, "cts_hevcb_clk"),
+	CLK_MSR_ID(99, "cts_hevcf_clk"),
+	CLK_MSR_ID(110, "cts_sc_clk(smartcard)"),
+	CLK_MSR_ID(111, "cts_sar_adc_clk"),
+	CLK_MSR_ID(113, "cts_sd_emmc_C_clk(nand)"),
+	CLK_MSR_ID(114, "cts_sd_emmc_B_clk"),
+	CLK_MSR_ID(115, "cts_sd_emmc_A_clk"),
+	CLK_MSR_ID(116, "gpio_msr_clk"),
+	CLK_MSR_ID(117, "cts_spicc_1_clk"),
+	CLK_MSR_ID(118, "cts_spicc_0_clk"),
+	CLK_MSR_ID(121, "cts_ts_clk(temp sensor)"),
+	CLK_MSR_ID(130, "audio_vad_clk"),
+	CLK_MSR_ID(131, "acodec_dac_clk_x128"),
+	CLK_MSR_ID(132, "audio_locker_out_clk"),
+	CLK_MSR_ID(133, "audio_locker_in_clk"),
+	CLK_MSR_ID(134, "audio_tdmout_c_sclk"),
+	CLK_MSR_ID(135, "audio_tdmout_b_sclk"),
+	CLK_MSR_ID(136, "audio_tdmout_a_sclk"),
+	CLK_MSR_ID(137, "audio_tdmin_lb_sclk"),
+	CLK_MSR_ID(138, "audio_tdmin_c_sclk"),
+	CLK_MSR_ID(139, "audio_tdmin_b_sclk"),
+	CLK_MSR_ID(140, "audio_tdmin_a_sclk"),
+	CLK_MSR_ID(141, "audio_resamplea_clk"),
+	CLK_MSR_ID(142, "audio_pdm_sysclk"),
+	CLK_MSR_ID(143, "audio_spdifoutb_mst_clk"),
+	CLK_MSR_ID(144, "audio_spdifout_mst_clk"),
+	CLK_MSR_ID(145, "audio_spdifin_mst_clk"),
+	CLK_MSR_ID(146, "audio_pdm_dclk"),
+	CLK_MSR_ID(147, "audio_resampleb_clk"),
+	CLK_MSR_ID(148, "earcrx_pll_dmac_ck"),
+	CLK_MSR_ID(160, "pwm_j_clk"),
+	CLK_MSR_ID(161, "pwm_i_clk"),
+	CLK_MSR_ID(162, "pwm_h_clk"),
+	CLK_MSR_ID(163, "pwm_g_clk"),
+	CLK_MSR_ID(164, "pwm_f_clk"),
+	CLK_MSR_ID(165, "pwm_e_clk"),
+	CLK_MSR_ID(166, "pwm_d_clk"),
+	CLK_MSR_ID(167, "pwm_c_clk"),
+	CLK_MSR_ID(168, "pwm_b_clk"),
+	CLK_MSR_ID(169, "pwm_a_clk"),
+	CLK_MSR_ID(176, "rng_ring_0"),
+	CLK_MSR_ID(177, "rng_ring_1"),
+	CLK_MSR_ID(178, "rng_ring_2"),
+	CLK_MSR_ID(179, "rng_ring_3"),
+	CLK_MSR_ID(180, "dmc_osc_ring(LVT16)"),
+	CLK_MSR_ID(181, "gpu_osc_ring0(LVT16)"),
+	CLK_MSR_ID(182, "gpu_osc_ring1(ULVT16)"),
+	CLK_MSR_ID(183, "gpu_osc_ring2(SLVT16)"),
+	CLK_MSR_ID(184, "vpu_osc_ring0(SVT24)"),
+	CLK_MSR_ID(185, "vpu_osc_ring1(LVT20)"),
+	CLK_MSR_ID(186, "vpu_osc_ring2(LVT16)"),
+	CLK_MSR_ID(187, "dos_osc_ring0(SVT24)"),
+	CLK_MSR_ID(188, "dos_osc_ring1(SVT16)"),
+	CLK_MSR_ID(189, "dos_osc_ring2(LVT16)"),
+	CLK_MSR_ID(190, "dos_osc_ring3(ULVT20)"),
+	CLK_MSR_ID(191, "ddr_osc_ring(LVT16)"),
+	CLK_MSR_ID(192, "sys_cpu_osc_ring0(ULVT16)"),
+	CLK_MSR_ID(193, "sys_cpu_osc_ring1(ULVT20)"),
+	CLK_MSR_ID(194, "sys_cpu_osc_ring2(ULVT16)"),
+	CLK_MSR_ID(195, "sys_cpu_osc_ring3(LVT16)"),
+	CLK_MSR_ID(196, "axi_sram_osc_ring(SVT16)"),
+	CLK_MSR_ID(197, "dspa_osc_ring(SVT16)"),
+};
+
+
 static int meson_measure_id(struct meson_msr_id *clk_msr_id,
 			    unsigned int duration)
 {
@@ -1059,6 +1191,10 @@
 		.compatible = "amlogic,s4-clk-measure",
 		.data = &clk_msr_s4_data,
 	},
+	{
+		.compatible = "amlogic,meson-sc2-clk-measure",
+		.data = (void *)clk_msr_sc2,
+	},
 	{ /* sentinel */ }
 };
 MODULE_DEVICE_TABLE(of, meson_msr_match_table);
