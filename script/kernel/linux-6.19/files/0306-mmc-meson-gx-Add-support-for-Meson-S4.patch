Patch from MiniMyth2 project

Developed-by: Piotr Oniszczuk <piotr.oniszczuk@gmail.com>
Signed-off-by: Piotr Oniszczuk <piotr.oniszczuk@gmail.com>




From: devmfc <devmfc@mvand.net>
Subject: [PATCH 25/32] [DEVMFC] mmc: meson-gx: Add support for Meson S4

---
 drivers/mmc/host/meson-gx-mmc.c | 6 ++++++
 1 file changed, 6 insertions(+)

diff --git a/drivers/mmc/host/meson-gx-mmc.c b/drivers/mmc/host/meson-gx-mmc.c
index 694bb443d5..9e164fa2af 100644
--- a/drivers/mmc/host/meson-gx-mmc.c
+++ b/drivers/mmc/host/meson-gx-mmc.c
@@ -449,6 +449,11 @@ static int meson_mmc_clk_init(struct meson_host *host)
 					     "Missing clock %s\n", name);
 
 		mux_parent_names[i] = __clk_get_name(clk);
+		
+		if(i==0)
+			ret = clk_set_rate(clk, 24000000);  // DEVMFC: from 4.9.180 needed for SC2 and S4
+		if (ret) 
+			return ret;
 	}
 
 	/* create the mux */
@@ -1328,6 +1333,7 @@ static const struct of_device_id meson_mmc_of_match[] = {
 	{ .compatible = "amlogic,meson-gxl-mmc",	.data = &meson_gx_data },
 	{ .compatible = "amlogic,meson-gxm-mmc",	.data = &meson_gx_data },
 	{ .compatible = "amlogic,meson-axg-mmc",	.data = &meson_axg_data },
+	{ .compatible = "amlogic,meson-s4-mmc",		.data = &meson_axg_data },
 	{}
 };
 MODULE_DEVICE_TABLE(of, meson_mmc_of_match);
-- 
2.46.0

--

MiniMyth2

