From 435a208e1be07b7bd9a9c8ed6d5879668cc67ae5 Mon Sep 17 00:00:00 2001
From: devmfc <devmfc@mvand.net>
Date: Mon, 2 Oct 2023 21:18:10 +0200
Subject: [PATCH 23/32] [DEVMFC] arch/arm64: dts: meson-s4: Add USB2 support

Add USB2 support to S4 SoC family

Signed-off-by: devmfc <devmfc@mvand.net>
---
 arch/arm64/boot/dts/amlogic/meson-s4.dtsi | 43 +++++++++++++++++++++++
 1 file changed, 43 insertions(+)

diff --git a/arch/arm64/boot/dts/amlogic/meson-s4.dtsi b/arch/arm64/boot/dts/amlogic/meson-s4.dtsi
index 339fbf7886..8246aff36d 100644
--- a/arch/arm64/boot/dts/amlogic/meson-s4.dtsi
+++ b/arch/arm64/boot/dts/amlogic/meson-s4.dtsi
@@ -860,6 +860,28 @@ uart_b: serial@7a000 {
 				status = "disabled";
 			};
 
+			usb2_phy0: phy@3c000 {
+				compatible = "amlogic,s4-usb2-phy";
+				reg = <0x0 0x3c000 0x0 0x2000>;
+				clocks = <&xtal>;
+				clock-names = "xtal";
+				resets = <&reset RESET_USBPHY20>;
+				reset-names = "phy";
+				#phy-cells = <0>;
+				status = "disabled";
+			};
+
+			usb2_phy1: phy@3e000 {
+				compatible = "amlogic,s4-usb2-phy";
+				reg = <0x0 0x3e000 0x0 0x2000>;
+				clocks = <&xtal>;
+				clock-names = "xtal";
+				resets = <&reset RESET_USBPHY21>;
+				reset-names = "phy";
+				#phy-cells = <0>;
+				status = "disabled";
+			};
+
 			reset: reset-controller@2000 {
 				compatible = "amlogic,meson-s4-reset";
 				reg = <0x0 0x2000 0x0 0x98>;
@@ -1009,6 +1029,31 @@ hdmi_tx_out: endpoint {
 				};
 			};
 		};
+
+		usb: usb@fe03a000 {
+			compatible = "amlogic,meson-g12a-usb-ctrl";
+			reg = <0x0 0xfe03a000 0x0 0xa0>;
+			interrupts = <GIC_SPI 129 IRQ_TYPE_LEVEL_HIGH>;
+			#address-cells = <2>;
+			#size-cells = <2>;
+			ranges;
+			clocks = <&clkc_periphs CLKID_USB>;
+			resets = <&reset RESET_USBCTRL>;
+			power-domains = <&pwrc PWRC_S4_USB_COMB_ID>;
+			dr_mode = "host";
+			phys = <&usb2_phy0>, <&usb2_phy1>;
+			phy-names = "usb2-phy0", "usb2-phy1";
+			status = "disabled";
+
+			crg_xhci: usb@fde00000 {
+				compatible = "generic-xhci";
+				status = "okay";
+				reg = <0x0 0xfde00000 0x0 0x100000>;
+				interrupts = <GIC_SPI 130 IRQ_TYPE_LEVEL_HIGH>;
+				clocks = <&clkc_periphs CLKID_USB1_TO_DDR>;
+
+			};
+		};
 	};
 };
 
-- 
2.46.0

