From 04e0a1758adbb39f6826698bad018d7a63f9bf62 Mon Sep 17 00:00:00 2001
From: Jean-Yves Avenard <jyavenard@mythtv.org>
Date: Thu, 26 Jun 2014 16:32:26 +1000
Subject: [PATCH 04/16] Uses 16-bytes aligned memory buffer.

This allows FFmpeg to use SSE accelerated code
---
 mythtv/libs/libmythtv/mhi.cpp |    4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/mythtv/libs/libmythtv/mhi.cpp b/mythtv/libs/libmythtv/mhi.cpp
index cf39bc2..0418277 100644
--- a/mythtv/libs/libmythtv/mhi.cpp
+++ b/mythtv/libs/libmythtv/mhi.cpp
@@ -1858,7 +1858,7 @@ void MHIBitmap::CreateFromMPEG(const unsigned char *data, int length)
         memset(&retbuf, 0, sizeof(AVPicture));
 
         int bufflen = nContentWidth * nContentHeight * 3;
-        unsigned char *outputbuf = new unsigned char[bufflen];
+        unsigned char *outputbuf = (unsigned char*)av_malloc(bufflen);
 
         avpicture_fill(&retbuf, outputbuf, PIX_FMT_RGB24,
                        nContentWidth, nContentHeight);
@@ -1882,7 +1882,7 @@ void MHIBitmap::CreateFromMPEG(const unsigned char *data, int length)
                 m_image.setPixel(j, i, qRgb(red, green, blue));
             }
         }
-        delete [] outputbuf;
+        av_freep(&outputbuf);
     }
 
 Close:
-- 
1.7.10.2

