Patch from MiniMyth2 project

Developed-by: Piotr Oniszczuk <piotr.oniszczuk@gmail.com>
Signed-off-by: Piotr Oniszczuk <piotr.oniszczuk@gmail.com>



diff --speed-large-files --no-dereference --minimal -Naur linux-6.19-rc8/arch/arm64/boot/dts/allwinner/sun50i-h616.dtsi linux-6.19-rc8/arch/arm64/boot/dts/allwinner/sun50i-h616.dtsi
--- linux-6.19-rc8/arch/arm64/boot/dts/allwinner/sun50i-h616.dtsi	2026-02-05 15:15:07.218613862 +0100
+++ linux-6.19-rc8/arch/arm64/boot/dts/allwinner/sun50i-h616.dtsi	2026-02-05 14:55:21.269072854 +0100
@@ -268,6 +268,77 @@
 			status = "disabled";
 		};
 
+		ahub_dam_plat:ahub_dam_plat@5097000 {
+			#sound-dai-cells = <0>;
+			/* sound card without pcm for hardware mix setting */
+			compatible = "allwinner,sunxi-snd-plat-ahub_dam";
+			reg = <0x05097000 0x1000>;
+			resets = <&ccu RST_BUS_AUDIO_HUB>;
+			clocks = <&ccu CLK_AUDIO_CODEC_1X>,
+				 <&ccu CLK_AUDIO_CODEC_4X>,
+				 <&ccu CLK_AUDIO_HUB>,
+				 <&ccu CLK_BUS_AUDIO_HUB>;
+			clock-names = "clk_pll_audio",
+				      "clk_pll_audio_4x",
+				      "clk_audio_hub",
+				      "clk_bus_audio_hub";
+			status = "disabled";
+		};
+
+		ahub_dam_mach:ahub_dam_mach {
+			compatible = "allwinner,sunxi-snd-mach";
+			soundcard-mach,name = "ahubdam";
+			status = "disabled";
+
+			soundcard-mach,cpu {
+				sound-dai = <&ahub_dam_plat>;
+			};
+
+			soundcard-mach,codec {
+			};
+		};
+
+		ahub1_plat:ahub1_plat {
+			#sound-dai-cells = <0>;
+			compatible = "allwinner,sunxi-snd-plat-ahub";
+			apb_num = <1>; /* for dma port 4 */
+			dmas = <&dma 4>, <&dma 4>;
+			dma-names = "tx", "rx";
+			playback_cma = <128>;
+			capture_cma = <128>;
+			tx_fifo_size = <128>;
+			rx_fifo_size = <128>;
+
+			tdm_num = <1>;
+			tx_pin = <0>;
+			rx_pin = <0>;
+			status = "disabled";
+		};
+
+		ahub1_mach:ahub1_mach {
+			compatible = "allwinner,sunxi-snd-mach";
+			soundcard-mach,name = "HDMI";
+
+			soundcard-mach,format = "i2s";
+			soundcard-mach,frame-master = <&ahub1_cpu>;
+			soundcard-mach,bitclock-master = <&ahub1_cpu>;
+			/* soundcard-mach,frame-inversion; */
+			/* soundcard-mach,bitclock-inversion; */
+			soundcard-mach,slot-num = <2>;
+			soundcard-mach,slot-width = <32>;
+			status = "disabled";
+
+			ahub1_cpu: soundcard-mach,cpu {
+				sound-dai = <&ahub1_plat>;
+				soundcard-mach,pll-fs = <4>;
+				soundcard-mach,mclk-fs = <0>;
+			};
+
+			ahub1_codec: soundcard-mach,codec {
+				sound-dai = <&hdmi>;
+			};
+		};
+
 		crypto: crypto@1904000 {
 			compatible = "allwinner,sun50i-h616-crypto";
 			reg = <0x01904000 0x800>;
@@ -1077,6 +1148,7 @@
 			reset-names = "ctrl", "hdcp";
 			phys = <&hdmi_phy>;
 			phy-names = "phy";
+			#sound-dai-cells = <0>;
 			status = "disabled";
 
 			ports {
--

MiniMyth2

